# TODO: 고급 비디오 프로세싱 로드맵
[**English**](./TODO.md) | [**한국어**]
[README로 돌아가기](../README_kor.md)

이 로드맵은 기초적인 컬러 바 출력부터 고급 실시간 이미지 프로세싱에 이르기까지 고성능 비디오 파이프라인을 구축하기 위한 단계를 개략적으로 설명합니다.

## 1단계: 기반 구축 (Nios II 패턴 및 DMA) ✅
- [x] **DDR3 패턴 생성**: DDR3(0x2000_0000)를 720p 컬러바로 채우는 Nios II 코드를 작성합니다.
- [x] **하드웨어 DMA 마스터**: 고속 DDR3 액세스를 위한 `burst_master`를 구현하고 검증합니다.
- [x] **성능 벤치마크**: 소프트웨어 복사 대비 500배 이상의 성능 향상을 확인합니다.

## 2단계: 하드웨어 확장 (RTL 싱크 제네레이터 및 고급 제어) ✅
- [x] **커스텀 싱크 제네레이터**: H/V 동기화 및 DE를 지원하는 `hdmi_sync_gen.v`를 구현합니다.
- [x] **RTL 패턴**: 싱크 제네레이터에 내장 패턴(Greyscale, Grid, Character Tile)을 추가합니다.
- [x] **고급 감마 보정**: sRGB 및 Inverse Gamma 2.2 LUT를 구현합니다.
- [x] **Nios II 하위 메뉴**: 실시간 감마 및 패턴 제어를 위한 중첩 메뉴를 생성합니다.
- [x] **타이밍 및 주소 지정 수정**: SDC 타이밍 위반 및 Avalon-MM 주소 매핑 버그를 해결합니다.
- [x] **동적 컬러링**: 캐릭터 렌더링에 좌표 기반 무지개 효과를 구현합니다.

## 3단계: qHD 비디오 출력 ✅
- [x] **해상도 최적화**: 대역폭 준수를 위해 720p에서 qHD(960×540@60Hz)로 변경합니다.
- [x] **듀얼 클록 아키텍처**: CSR(50MHz)과 Pixel(37.8MHz) 클록 도메인을 분리하고 CDC를 적용합니다.
- [x] **정적 이미지 디스플레이**: Nios II가 DMA를 통해 DDR3에서 이미지를 로드하고 표시합니다.
- [x] **리눅스 비디오 플레이어**: HPS가 `/dev/mem` 더블 버퍼링을 사용하여 비디오를 스트리밍합니다.
- [x] **V-Sync 동기화**: 티어링 없는 업데이트를 위한 프레임 포인터 래칭을 구현합니다.
- [x] **Qsys HPS 브릿지**: 리눅스 제어를 위해 `h2f_lw_axi_master`를 HDMI CSR에 연결합니다.

## 4단계: 비디오 재생 최적화 및 대역폭 확장 ⏳
- [ ] **버스 폭 확장**: 버스 폭을 4바이트에서 8/16바이트로 확장합니다. (목표: 50MHz에서 400 MB/s)
  - 목표: 여유 대역폭을 확보한 상태에서 720p@60Hz (222 MB/s) 지원
  - 클록 주파수는 50MHz 유지
  - burst_master의 Avalon-MM 인터페이스 너비 수정
- [ ] **RAM 사전 로드 모드**: 짧은 비디오(4-5초)에 대해 60fps를 보장하는 사전 로드 전략을 복구합니다.
- [ ] **해상도 스케일링**: 지속적인 SD 카드 스트리밍을 위한 480p/360p 모드를 추가합니다.
- [ ] **비디오 압축 지원**: H.264/MJPEG 하드웨어 디코더 통합을 검토합니다.
- [ ] **오디오 통합**: 비디오와 동기화된 I2S 오디오 재생 기능을 추가합니다.
- [ ] **성능 프로파일링**: `ftrace`를 사용하여 읽기 지연 시간을 측정하고 최적화합니다.

## 5단계: 실시간 프로세싱 (라인 버퍼 및 필터)
- [ ] **라인 버퍼 설계**: 3x3 윈도우 처리를 위한 듀얼 포트 RAM 기반 라인 버퍼를 구현합니다.
- [ ] **프로세싱 코어**: `video_processing_core.v` 구현
    - [ ] **그레이스케일/이진화**: 기본적인 픽셀 단위 처리
    - [ ] **Sobel 엣지 검출**: 라인 버퍼를 활용한 고속 공간 필터링
    - [ ] **가우시안 블러**: 노이즈 제거를 위한 스무딩 필터
- [ ] **실시간 전활**: 제어 레지스터를 통해 처리된 영상과 원본 영상 사이를 전환합니다.

## 6단계: 고급 기능
- [ ] **공간 디더링 (Spatial Dithering)**: 밴딩 현상을 줄이기 위한 Bayer Matrix 기반 디더링을 구현합니다.
- [ ] **리눅스 DRM/KMS 통합**: 비디오 파이프라인을 표준 리눅스 디스플레이 장치로 매핑합니다.
- [ ] **카메라 입력**: 실시간 처리를 위한 MIPI CSI-2 카메라 인터페이스 추가를 검토합니다.
- [ ] **AI 가속**: 하드웨어 기반 AI 인식 코어(YOLO 등) 통합을 검토합니다.

## 하드웨어/Qsys 요구 사항 (공통) ✅
- [x] **클록킹**: 37.83 MHz 픽셀 클록 PLL + SDC 제약 조건
- [x] **I2C 제어**: Nios II를 통한 ADV7513 초기화
- [x] **최상위 배선**: `DE10_NANO_SoC_GHRD.v`에서 HDMI_TX 핀 할당
- [x] **HPS 브릿지**: 리눅스 CSR 액세스를 위한 Lightweight AXI 브릿지

## 알려진 문제 및 제한 사항
- **SD 카드 병목**: 원본 비디오는 124 MB/s를 필요로 하나, SD 카드는 약 20 MB/s만 제공함
  - 영향: 지속 재생 시 약 10-15 fps로 제한됨
  - 해결책: 짧은 클립은 RAM 사전 로드를 사용하거나 해상도를 낮춤
- **메모리 제약**: 비디오용으로 예약된 512MB DDR3는 사전 로드 시 약 250 프레임으로 제한됨
- **오디오 미지원**: 현재 비디오 전용으로 구현됨

## 문서화 현황
- [x] 상세 구현 내용을 담은 `VIDEO_PLAYBACK.md` 작성 완료
- [x] qHD 성과를 반영하여 `README.md` 업데이트 완료
- [ ] 상세 측정값을 포함한 성능 벤치마크 문서 작성
- [ ] 일반적인 문제 해결을 위한 트러블슈팅 가이드 추가
